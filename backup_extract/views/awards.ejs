<%
  const hasAwards =
    awardsByYear &&
    Object.keys(awardsByYear).length > 0;

  const years = hasAwards
    ? Object.keys(awardsByYear).map(Number).sort((a, b) => b - a)
    : [];

  const currentAwards =
    currentYear && awardsByYear && awardsByYear[currentYear]
      ? awardsByYear[currentYear]
      : [];

  const categoryLabelFn =
    typeof categoryLabel === "function"
      ? categoryLabel
      : (c) => c;
%>

<section class="space-y-8 animate-fadeIn">
  <!-- TÍTULO / INTRO -->
  <header class="space-y-2">
    <p class="text-[11px] uppercase tracking-wide text-horriver-gray">
      Premiação oficial da pelada
    </p>
    <h1 class="font-title text-3xl md:text-4xl text-horriver-light">
      Campeões da temporada
    </h1>
    <p class="text-sm text-horriver-gray max-w-2xl">
      Aqui ficam registrados os melhores do ano da Horriver Plate:
      melhor jogador, artilheiro e destaques por posição. A galera
      que marcou a história da resenha em cada temporada.
    </p>
  </header>

  <% if (!hasAwards) { %>
    <!-- NENHUMA PREMIAÇÃO AINDA -->
    <div class="mt-4 bg-black/50 border border-horriver-border rounded-2xl px-4 py-6 text-sm text-horriver-gray">
      Nenhuma premiação cadastrada ainda. Assim que os campeões forem definidos
      no painel, eles aparecem aqui automaticamente.
    </div>
  <% } else { %>

    <!-- CAMPEÕES ATUAIS - DESTAQUE -->
    <% if (currentYear && currentAwards && currentAwards.length) { %>
      <section
        class="rounded-3xl bg-gradient-to-r from-horriver-red/75 via-black/90 to-horriver-orange/80
               border border-horriver-red/80 px-5 py-6 md:px-8 md:py-7 shadow-xl"
      >
        <div class="flex flex-col lg:flex-row lg:items-center gap-6">
          <!-- Texto -->
          <div class="flex-1 space-y-2">
            <span
              class="inline-flex items-center px-3 py-1 rounded-full bg-black/40
                     border border-horriver-orange/70 text-[11px] text-horriver-gray uppercase tracking-wide"
            >
              Campeões atuais · <%= currentYear %>
            </span>
            <h2 class="font-title text-2xl md:text-3xl text-horriver-light">
              Os donos da temporada <%= currentYear %>
            </h2>
            <p class="text-sm text-horriver-gray max-w-lg">
              Esses são os jogadores que levaram os prêmios mais importantes da
              temporada: de melhor jogador geral até os destaques por posição.
              O topo da resenha.
            </p>
          </div>

          <!-- Lista de campeões -->
          <div class="flex-[1.2] grid grid-cols-1 sm:grid-cols-2 gap-3 text-[11px]">
            <% currentAwards.forEach((award) => { %>
              <div
                class="bg-black/60 border border-horriver-border/80 rounded-xl px-3 py-2.5
                       flex flex-col gap-1 shadow-card-soft"
              >
                <p class="text-[10px] text-horriver-gray uppercase tracking-wide">
                  <%= categoryLabelFn(award.category) %>
                </p>
                <p class="text-sm text-horriver-light font-semibold">
                  <%= award.player.name %>
                  <% if (award.player.nickname) { %>
                    <span class="text-[11px] text-horriver-gray">
                      (<%= award.player.nickname %>)
                    </span>
                  <% } %>
                </p>
                <% if (award.player.position) { %>
                  <p class="text-[10px] text-horriver-orange uppercase">
                    <%= award.player.position %>
                  </p>
                <% } %>
              </div>
            <% }) %>
          </div>
        </div>
      </section>
    <% } %>

    <!-- LINHA DIVISÓRIA / TÍTULO LISTA COMPLETA -->
    <div class="pt-2 border-t border-horriver-border/60 mt-6">
      <div class="flex items-center justify-between gap-2 mb-3">
        <h2 class="font-title text-2xl text-horriver-light">
          Todas as temporadas
        </h2>
        <p class="text-[11px] text-horriver-gray">
          Clique nos anos para conferir quem foi premiado.
        </p>
      </div>
    </div>

    <!-- TIMELINE DE ANOS / CARDS -->
    <section class="space-y-4">
      <% years.forEach((year) => { 
           const list = awardsByYear[year] || [];
           const isCurrent = currentYear && Number(year) === Number(currentYear);
      %>
        <div
          class="border rounded-2xl px-4 py-3 md:px-5 md:py-4
                 <%= isCurrent ? 'border-horriver-orange/80 bg-black/70' : 'border-horriver-border bg-black/40' %>"
        >
          <!-- Cabeçalho do ano -->
          <details <%= isCurrent ? 'open' : '' %> class="group">
            <summary
              class="flex items-center justify-between gap-3 cursor-pointer list-none"
            >
              <div class="flex items-center gap-3">
                <div
                  class="w-9 h-9 rounded-full flex items-center justify-center
                         border
                         <%= isCurrent ? 'border-horriver-orange bg-horriver-orange/10' : 'border-horriver-border bg-black/70' %>"
                >
                  <span class="font-title text-sm text-horriver-light">
                    <%= year %>
                  </span>
                </div>
                <div>
                  <p class="text-sm text-horriver-light font-semibold">
                    Temporada <%= year %>
                    <% if (isCurrent) { %>
                      <span class="ml-1 text-[10px] px-2 py-[2px] rounded-full bg-horriver-orange/20 text-horriver-orange uppercase tracking-wide">
                        Atual
                      </span>
                    <% } %>
                  </p>
                  <p class="text-[11px] text-horriver-gray">
                    <%= list.length %> prêmio(s) registrado(s)
                  </p>
                </div>
              </div>

              <span class="text-[11px] text-horriver-gray group-open:rotate-180 transition-transform">
                ▼
              </span>
            </summary>

            <!-- Lista de prêmios do ano -->
            <div class="mt-3 border-t border-horriver-border/60 pt-3">
              <% if (!list.length) { %>
                <p class="text-[12px] text-horriver-gray">
                  Nenhum prêmio registrado para este ano.
                </p>
              <% } else { %>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 text-[11px]">
                  <% list.forEach((award) => { %>
                    <div
                      class="rounded-xl bg-horriver-dark/80 border border-horriver-border/80 px-3 py-2.5 flex flex-col gap-1"
                    >
                      <p class="text-[10px] text-horriver-gray uppercase tracking-wide">
                        <%= categoryLabelFn(award.category) %>
                      </p>
                      <p class="text-sm text-horriver-light font-semibold">
                        <%= award.player.name %>
                        <% if (award.player.nickname) { %>
                          <span class="text-[11px] text-horriver-gray">
                            (<%= award.player.nickname %>)
                          </span>
                        <% } %>
                      </p>
                      <% if (award.player.position) { %>
                        <p class="text-[10px] text-horriver-orange uppercase">
                          <%= award.player.position %>
                        </p>
                      <% } %>
                    </div>
                  <% }) %>
                </div>
              <% } %>
            </div>
          </details>
        </div>
      <% }) %>
    </section>
  <% } %>
</section>
