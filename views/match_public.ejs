<%
  const fmtDate = (d) =>
    d ? new Date(d).toLocaleDateString("pt-BR") : "-";

  const fmtRating = (val) => {
    if (val === null || val === undefined || Number.isNaN(val)) return "‚Äî";
    return Number(val).toFixed(2).replace(".", ",");
  };

  const safeStats = Array.isArray(stats) ? stats : [];
%>

<section class="space-y-6 animate-fadeIn">
  <!-- Cabe√ßalho da pelada -->
  <header class="space-y-2">
    <h1 class="font-title text-3xl md:text-4xl text-horriver-light">
      Pelada em <span class="text-horriver-orange"><%= fmtDate(match.playedAt) %></span>
    </h1>

    <div class="text-sm text-horriver-gray space-y-1">
      <p>
        <span class="font-semibold text-horriver-light">Descri√ß√£o:</span>
        <%= match.description || "Sem descri√ß√£o" %>
      </p>
      <p>
        <span class="font-semibold text-horriver-light">Time vencedor:</span>
        <%= match.winnerTeam || "Sem time vencedor" %>
      </p>
      <p class="text-[11px] text-horriver-gray/80 mt-1">
        Esta p√°gina √© apenas para visualiza√ß√£o p√∫blica. Para lan√ßar ou editar estat√≠sticas,
        use o painel do administrador.
      </p>
    </div>
  </header>

  <!-- Card grande com tabela -->
  <section
    class="relative mt-4 rounded-3xl border border-horriver-red/60 overflow-hidden
           bg-gradient-to-b from-black/80 via-horriver-dark to-black/95 shadow-card"
  >
    <!-- "Brilho" de fundo -->
    <div class="absolute inset-0 pointer-events-none opacity-70">
      <div
        class="absolute -top-32 left-10 w-80 h-80 bg-horriver-orange/15 blur-3xl rounded-full"
      ></div>
      <div
        class="absolute bottom-[-120px] right-[-80px] w-[380px] h-[380px]
               bg-horriver-red/30 blur-3xl rounded-full"
      ></div>
    </div>

    <!-- Conte√∫do -->
    <div class="relative z-10 px-4 md:px-6 py-4 md:py-5">
      <!-- T√≠tulo da tabela -->
      <div class="flex items-center justify-between gap-4 mb-3">
        <div>
          <h2 class="font-title text-xl text-horriver-light">
            Estat√≠sticas da pelada
          </h2>
          <p class="text-[11px] text-horriver-gray">
            Jogadores em ordem alfab√©tica, com gols, assist√™ncias, presen√ßa e nota.
          </p>
        </div>
        <p class="text-[11px] text-horriver-gray">
          Total de jogadores:
          <span class="text-horriver-orange font-semibold"><%= safeStats.length %></span>
        </p>
      </div>

      <!-- Wrapper com scroll -->
      <div class="mt-2 rounded-2xl border border-horriver-red/50 bg-black/60 overflow-hidden">
        <div class="max-h-[460px] overflow-y-auto scrollbar-thin scrollbar-thumb-horriver-red/60 scrollbar-track-transparent">
          <table class="min-w-full text-xs">
            <thead class="bg-gradient-to-r from-horriver-red/70 via-horriver-red/60 to-horriver-orange/70 text-[11px]">
              <tr>
                <th class="px-3 py-2 text-left w-10">#</th>
                <th class="px-3 py-2 text-left">Jogador</th>
                <th class="px-3 py-2 text-left">Posi√ß√£o</th>
                <th class="px-3 py-2 text-center">Presente</th>
                <th class="px-3 py-2 text-center">Gols</th>
                <th class="px-3 py-2 text-center">Assist.</th>
                <th class="px-3 py-2 text-center">Nota</th>
                <th class="px-3 py-2 text-center">Foto</th>
              </tr>
            </thead>
            <tbody>
              <% if (!safeStats.length) { %>
                <tr>
                  <td colspan="8" class="px-3 py-4 text-center text-sm text-horriver-gray">
                    Nenhuma estat√≠stica lan√ßada para esta pelada.
                  </td>
                </tr>
              <% } else { %>
                <% safeStats.forEach((s, idx) => { %>
                  <tr
                    class="border-t border-horriver-red/30 hover:bg-white/5 transition-colors"
                  >
                    <!-- # -->
                    <td class="px-3 py-2 text-[11px] text-horriver-gray">
                      <%= idx + 1 %>
                    </td>

                    <!-- Jogador -->
                    <td class="px-3 py-2">
                      <p class="text-horriver-light text-[13px]">
                        <%= s.player.name %>
                        <% if (s.player.nickname) { %>
                          <span class="text-horriver-gray text-[11px]">
                            ("<%= s.player.nickname %>")
                          </span>
                        <% } %>
                      </p>
                    </td>

                    <!-- Posi√ß√£o -->
                    <td class="px-3 py-2 text-[11px] text-horriver-orange uppercase">
                      <%= s.player.position %>
                    </td>

                    <!-- Presente -->
                    <td class="px-3 py-2 text-center">
                      <% if (s.present) { %>
                        <span class="text-emerald-400 text-sm">‚úî</span>
                      <% } else { %>
                        <span class="text-horriver-gray/70 text-xs">‚Äî</span>
                      <% } %>
                    </td>

                    <!-- Gols -->
                    <td class="px-3 py-2 text-center">
                      <span class="font-semibold text-horriver-light">
                        <%= s.goals || 0 %>
                      </span>
                    </td>

                    <!-- Assist√™ncias -->
                    <td class="px-3 py-2 text-center">
                      <span class="font-semibold text-horriver-light">
                        <%= s.assists || 0 %>
                      </span>
                    </td>

                    <!-- Nota -->
                    <td class="px-3 py-2 text-center">
                      <span class="font-semibold text-horriver-light">
                        <%= fmtRating(s.rating) %>
                      </span>
                    </td>

                    <!-- Foto (usa appearedInPhoto üëà) -->
                    <td class="px-3 py-2 text-center">
                      <% if (s.appearedInPhoto) { %>
                        <span class="text-horriver-orange text-base" title="Saiu na foto">
                          üì∏
                        </span>
                      <% } else { %>
                        <span class="text-horriver-gray/70 text-xs">‚Äî</span>
                      <% } %>
                    </td>
                  </tr>
                <% }) %>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Bot√£o voltar -->
      <div class="mt-4 flex justify-end">
        <a
          href="/"
          class="inline-flex items-center px-4 py-1.5 rounded-full text-[11px]
                 border border-horriver-border text-horriver-gray
                 hover:border-horriver-orange hover:text-horriver-orange
                 transition-colors"
        >
          Voltar para a home
        </a>
      </div>
    </div>
  </section>
</section>
